<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Guru - SD Lazuardi</title>

<style>
/* ===== BODY & BACKGROUND LOGO ===== */
body{
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(135deg,#64b5f6,#2196f3);
    margin:0;padding:20px;
    perspective:1200px;
    overflow-x:hidden;
    position:relative;
}

/* BACKGROUND LOGO LAZUARDI */
body::before{
    content:'';
    position:fixed;
    top:50%;
    left:50%;
    width:400px;
    height:400px;
    background:url('logo_lazuardi.png') no-repeat center/contain;
    transform:translate(-50%,-50%) rotateY(0deg) rotateX(0deg);
    animation:logo3D 30s linear infinite;
    opacity:0.08;
    pointer-events:none;
    z-index:0;
}

@keyframes logo3D{
    0%{transform:translate(-50%,-50%) rotateY(0deg) rotateX(0deg);}
    25%{transform:translate(-50%,-50%) rotateY(90deg) rotateX(20deg);}
    50%{transform:translate(-50%,-50%) rotateY(180deg) rotateX(0deg);}
    75%{transform:translate(-50%,-50%) rotateY(270deg) rotateX(-20deg);}
    100%{transform:translate(-50%,-50%) rotateY(360deg) rotateX(0deg);}
}

/* ===== CONTAINER ===== */
.container{
    max-width:1200px;
    margin:80px auto;
    background:#f0f8ffcc;
    border-radius:18px;
    padding:25px;
    box-shadow:0 10px 30px rgba(0,0,0,.25);
    position:relative;
    z-index:1;
    transform-style:preserve-3d;
    animation:fadeInUp 1s ease;
}
h2{text-align:center;color:#0d47a1;font-size:2em;}

/* ===== TABLE ===== */
table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
    font-size:16px;
    transform-style:preserve-3d;
}
th,td{
    padding:12px;
    border:1px solid #90caf9;
    text-align:center;
    transition:transform .3s;
}
th{background:#2196f3;color:white;}

th:hover,td:hover{
    transform:scale(1.05) rotateX(5deg) rotateY(5deg);
}

/* BADGES */
.badge-masuk{
    background:#4caf50;color:white;
    padding:5px 10px;border-radius:6px;font-weight:bold;
}
.badge-pulang{
    background:#ff7043;color:white;
    padding:5px 10px;border-radius:6px;font-weight:bold;
}
.belum{color:#f44336;font-weight:bold}

/* ===== STATISTICS ===== */
.stats{margin-top:35px}
.stat-title{font-weight:bold;color:#0d47a1;margin-bottom:10px}

.stat-bar{
    background:#e3f2fd;
    border-radius:8px;
    overflow:hidden;
    height:35px;
    margin-bottom:15px;
    position:relative;
    perspective:800px;
}
.stat-fill{
    height:100%;
    width:0%;
    color:white;
    text-align:right;
    padding-right:10px;
    line-height:35px;
    font-weight:bold;
    transition:width .8s cubic-bezier(.42,0,.58,1);
    transform:rotateY(0deg);
}
.label{position:absolute;left:10px;color:#0d47a1;font-weight:bold;z-index:1;}

.happy{background:#42a5f5}
.sad{background:#64b5f6}
.angry{background:#1e88e5}
.scared{background:#1976d2}
.tired{background:#ffb74d}
.excited{background:#ff8a65}

/* ===== TOP BUTTONS ===== */
.top-buttons{
    position:fixed;top:15px;right:15px;
    display:flex;flex-direction:column;gap:10px;
    z-index:10;
}
.top-buttons button{
    padding:12px 20px;border:none;border-radius:12px;
    font-weight:bold;cursor:pointer;color:white;
    box-shadow:0 4px 15px rgba(0,0,0,.3);
    transition:.3s;
}
.top-buttons button:hover{
    transform:scale(1.1) rotateY(5deg);
}
#btnAbsensi{background:#2196f3}
#btnReset{background:#f44336}

/* DOWNLOAD BUTTONS */
.download-btns{
    text-align:center;margin-top:25px;
}
.download-btns button{
    padding:12px 25px;border:none;border-radius:12px;
    font-weight:bold;cursor:pointer;color:white;
    margin:5px;
    box-shadow:0 4px 15px rgba(0,0,0,.3);
    transition:.4s;
}
.download-btns button:hover{
    transform:scale(1.1) rotateY(10deg) rotateX(5deg);
}
.excel{background:#4caf50}
.word{background:#1976d2}

/* ===== ANIMASI ===== */
@keyframes fadeInUp{
    from{opacity:0; transform:translateY(30px);}
    to{opacity:1; transform:translateY(0);}
}

</style>
</head>

<body>

<div class="top-buttons">
    <button id="btnAbsensi">‚Üí Buka Absensi</button>
    <button id="btnReset">Reset Data</button>
</div>

<div class="container">
<h2>Dashboard Guru - SD Lazuardi</h2>

<table>
<thead>
<tr>
    <th rowspan="2">Nama</th>
    <th colspan="3">Check In</th>
    <th colspan="3">Check Out</th>
</tr>
<tr>
    <th>Status</th><th>Waktu</th><th>Emoji</th>
    <th>Status</th><th>Waktu</th><th>Emoji</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<div class="stats">
<div class="stat-title">üìä Statistik Emoji</div>
<div class="stat-bar"><div class="label">üòä Happy</div><div id="happy" class="stat-fill happy">0%</div></div>
<div class="stat-bar"><div class="label">üò¢ Sad</div><div id="sad" class="stat-fill sad">0%</div></div>
<div class="stat-bar"><div class="label">üò° Angry</div><div id="angry" class="stat-fill angry">0%</div></div>
<div class="stat-bar"><div class="label">üò± Scared</div><div id="scared" class="stat-fill scared">0%</div></div>
<div class="stat-bar"><div class="label">üò¥ Tired</div><div id="tired" class="stat-fill tired">0%</div></div>
<div class="stat-bar"><div class="label">ü§© Excited</div><div id="excited" class="stat-fill excited">0%</div></div>
</div>

<div class="download-btns">
    <button class="excel" onclick="downloadExcel()">‚¨áÔ∏è Download Excel</button>
    <button class="word" onclick="downloadWord()">‚¨áÔ∏è Download Word</button>
</div>
</div>

<script>
let absensiData = JSON.parse(localStorage.getItem("absensiData")) || [];

document.getElementById("btnAbsensi").onclick = ()=>location.href="index.html";
document.getElementById("btnReset").onclick = ()=>{
    if(confirm("Reset semua data?")){
        localStorage.removeItem("absensiData");
        absensiData=[];
        updateDashboard();
    }
};

function updateDashboard(){
    const tbody=document.getElementById("tableBody");
    tbody.innerHTML="";

    let siswa={};
    let stats={'üòä':0,'üò¢':0,'üò°':0,'üò±':0,'üò¥':0,'ü§©':0};

    absensiData.forEach(d=>{
        if(!siswa[d.nama]) siswa[d.nama]={checkin:null,checkout:null};
        if(d.status==="Check In") siswa[d.nama].checkin=d;
        if(d.status==="Check Out") siswa[d.nama].checkout=d;
        if(stats[d.emoji]!==undefined) stats[d.emoji]++;
    });

    Object.keys(siswa).forEach(nama=>{
        const m=siswa[nama].checkin;
        const p=siswa[nama].checkout;

        tbody.innerHTML+=`
        <tr>
            <td>${nama}</td>
            <td>${m?'<span class="badge-masuk">Check In</span>':'<span class="belum">‚Äì</span>'}</td>
            <td>${m?m.waktu:'-'}</td>
            <td>${m?m.emoji:'-'}</td>
            <td>${p?'<span class="badge-pulang">Check Out</span>':'<span class="belum">Belum</span>'}</td>
            <td>${p?p.waktu:'-'}</td>
            <td>${p?p.emoji:'-'}</td>
        </tr>`;
    });

    const total=Object.values(stats).reduce((a,b)=>a+b,0)||1;
    setBar("happy",stats['üòä'],total);
    setBar("sad",stats['üò¢'],total);
    setBar("angry",stats['üò°'],total);
    setBar("scared",stats['üò±'],total);
    setBar("tired",stats['üò¥'],total);
    setBar("excited",stats['ü§©'],total);
}

function setBar(id,val,total){
    const p=Math.round((val/total)*100);
    const bar=document.getElementById(id);
    bar.style.width=p+"%";
    bar.textContent=p+"%";
}

/* ===== DOWNLOAD EXCEL ===== */
function downloadExcel(){
    if(absensiData.length===0){alert("Tidak ada data");return;}
    let csv="Nama,Status,Waktu,Emoji\n";
    absensiData.forEach(d=>{
        csv+=`${d.nama},${d.status},${d.waktu},${d.emoji}\n`;
    });
    const blob=new Blob([csv],{type:"text/csv"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;a.download="absensi_sd_lazuardi.csv";
    a.click();
    URL.revokeObjectURL(url);
    animateDownload();
}

/* ===== DOWNLOAD WORD ===== */
function downloadWord(){
    if(absensiData.length===0){alert("Tidak ada data");return;}
    let html=`<h2>Absensi SD Lazuardi</h2>
    <table border="1" cellpadding="8" cellspacing="0">
    <tr><th>Nama</th><th>Status</th><th>Waktu</th><th>Emoji</th></tr>`;

    absensiData.forEach(d=>{
        html+=`<tr>
        <td>${d.nama}</td>
        <td>${d.status}</td>
        <td>${d.waktu}</td>
        <td>${d.emoji}</td>
        </tr>`;
    });
    html+=`</table>`;

    const blob=new Blob(
        ['<html><body>'+html+'</body></html>'],
        {type:"application/msword"}
    );
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;a.download="absensi_sd_lazuardi.doc";
    a.click();
    URL.revokeObjectURL(url);
    animateDownload();
}

/* ===== DOWNLOAD ANIMATION ===== */
function animateDownload(){
    const anim=document.createElement('div');
    anim.textContent="üì¶ File Sedang Diunduh...";
    anim.style.position="fixed";
    anim.style.top="50%";
    anim.style.left="50%";
    anim.style.transform="translate(-50%,-50%) scale(0)";
    anim.style.padding="15px 25px";
    anim.style.background="#4caf50";
    anim.style.color="white";
    anim.style.fontWeight="bold";
    anim.style.borderRadius="12px";
    anim.style.boxShadow="0 4px 15px rgba(0,0,0,.3)";
    anim.style.zIndex=9999;
    anim.style.transition="transform .5s ease, opacity .5s ease";
    document.body.appendChild(anim);
    requestAnimationFrame(()=>{
        anim.style.transform="translate(-50%,-50%) scale(1)";
        anim.style.opacity="1";
    });
    setTimeout(()=>{
        anim.style.transform="translate(-50%,-50%) scale(0)";
        anim.style.opacity="0";
        setTimeout(()=>document.body.removeChild(anim),500);
    },1200);
}

window.addEventListener("storage",()=>{
    absensiData=JSON.parse(localStorage.getItem("absensiData"))||[];
    updateDashboard();
});

updateDashboard();
</script>

</body>
</html>
