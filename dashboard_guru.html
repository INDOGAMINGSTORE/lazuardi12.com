<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Guru - SD Lazuardi</title>

<style>
body{
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(135deg,#64b5f6,#2196f3);
    margin:0;padding:20px;
}

/* ===== TOP BUTTON ===== */
.top-buttons{
    position:fixed;top:15px;right:15px;
    display:flex;flex-direction:column;gap:10px;
    z-index:999;
}
.top-buttons button{
    padding:10px 18px;
    border:none;border-radius:12px;
    font-weight:bold;cursor:pointer;color:white;
}
#btnAbsensi{background:#2196f3}
#btnReset{background:#f44336}

/* ===== CONTAINER ===== */
.container{
    max-width:1200px;
    margin:90px auto;
    background:#f0f8ff;
    border-radius:18px;
    padding:25px;
    box-shadow:0 6px 25px rgba(0,0,0,.25);
    animation: slideCute .8s ease;
}
h2{
    text-align:center;
    color:#0d47a1;
    animation: float 3s ease-in-out infinite;
}

/* ===== TABLE ===== */
table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}
th,td{
    padding:12px;
    border:1px solid #90caf9;
    text-align:center;
}
th{background:#2196f3;color:white}

/* ===== BADGE ===== */
.badge-masuk{
    background:#4caf50;color:white;
    padding:5px 10px;border-radius:10px;font-weight:bold;
}
.badge-pulang{
    background:#ff7043;color:white;
    padding:5px 10px;border-radius:10px;font-weight:bold;
}

/* ===== STATS ===== */
.stats{margin-top:35px}
.stat-title{font-weight:bold;color:#0d47a1;margin-bottom:10px}
.stat-bar{
    background:#e3f2fd;border-radius:10px;
    overflow:hidden;height:30px;margin-bottom:12px;
    position:relative;
}
.stat-fill{
    height:100%;width:0%;
    color:white;text-align:right;
    padding-right:10px;line-height:30px;
    font-weight:bold;transition:width .8s;
}
.label{
    position:absolute;left:10px;
    color:#0d47a1;font-weight:bold;
}

.happy{background:#42a5f5}
.sad{background:#64b5f6}
.angry{background:#1e88e5}
.scared{background:#1976d2}
.tired{background:#ffb74d}
.excited{background:#ff8a65}

/* ===== DOWNLOAD BUTTON ===== */
.download-btns{
    text-align:center;
    margin-top:30px;
}
.download-btns button{
    padding:12px 22px;
    border:none;border-radius:14px;
    font-weight:bold;
    cursor:pointer;
    color:white;
    margin:8px;
    font-size:16px;
    transition:.3s;
}
.excel{background:#4caf50}
.word{background:#1976d2}
.download-btns button:hover{
    transform:scale(1.08);
}

/* ===== DOWNLOAD ANIMATION ===== */
.download-overlay{
    position:fixed;inset:0;
    background:rgba(33,150,243,.85);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
    opacity:0;
    pointer-events:none;
    transition:.3s;
}
.download-overlay.active{
    opacity:1;
    pointer-events:auto;
}
.download-box{
    background:white;
    padding:30px;
    border-radius:18px;
    text-align:center;
    animation: pop .6s ease;
}
.download-box span{
    font-size:60px;
    display:block;
    animation: bounce 1.2s infinite;
}
.download-box p{
    font-weight:bold;
    color:#0d47a1;
}

/* ===== ANIMASI ===== */
@keyframes float{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-6px)}
}
@keyframes slideCute{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}
@keyframes pop{
  from{transform:scale(.5);opacity:0}
  to{transform:scale(1);opacity:1}
}
@keyframes bounce{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-10px)}
}
</style>
</head>

<body>

<div class="top-buttons">
    <button id="btnAbsensi">‚Üí Buka Absensi</button>
    <button id="btnReset">Reset Data</button>
</div>

<div class="container">
<h2>üè´ Dashboard Kehadiran SD Lazuardi üåü</h2>

<table>
<thead>
<tr>
    <th rowspan="2">Nama</th>
    <th colspan="3">Check In</th>
    <th colspan="3">Check Out</th>
</tr>
<tr>
    <th>Status</th><th>Waktu</th><th>Emoji</th>
    <th>Status</th><th>Waktu</th><th>Emoji</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<div class="stats">
<div class="stat-title">üìä Perasaan Anak Hari Ini</div>
<div class="stat-bar"><div class="label">üòä Senang</div><div id="happy" class="stat-fill happy">0%</div></div>
<div class="stat-bar"><div class="label">üò¢ Sedih</div><div id="sad" class="stat-fill sad">0%</div></div>
<div class="stat-bar"><div class="label">üò° Marah</div><div id="angry" class="stat-fill angry">0%</div></div>
<div class="stat-bar"><div class="label">üò± Takut</div><div id="scared" class="stat-fill scared">0%</div></div>
<div class="stat-bar"><div class="label">üò¥ Capek</div><div id="tired" class="stat-fill tired">0%</div></div>
<div class="stat-bar"><div class="label">ü§© Semangat</div><div id="excited" class="stat-fill excited">0%</div></div>
</div>

<div class="download-btns">
    <button class="excel" onclick="downloadExcel()">‚¨áÔ∏è Download Excel</button>
    <button class="word" onclick="downloadWord()">‚¨áÔ∏è Download Word</button>
</div>
</div>

<!-- DOWNLOAD ANIMATION -->
<div class="download-overlay" id="downloadAnim">
    <div class="download-box">
        <span>üì•</span>
        <p>Sedang Menyiapkan File...</p>
    </div>
</div>

<script>
let absensiData = JSON.parse(localStorage.getItem("absensiData")) || [];

btnAbsensi.onclick=()=>location.href="index.html";
btnReset.onclick=()=>{
    if(confirm("Reset semua data?")){
        localStorage.removeItem("absensiData");
        absensiData=[];
        updateDashboard();
    }
};

function updateDashboard(){
    const tbody=document.getElementById("tableBody");
    tbody.innerHTML="";
    let siswa={}, stats={'üòä':0,'üò¢':0,'üò°':0,'üò±':0,'üò¥':0,'ü§©':0};

    absensiData.forEach(d=>{
        if(!siswa[d.nama]) siswa[d.nama]={in:null,out:null};
        if(d.status==="Check In") siswa[d.nama].in=d;
        if(d.status==="Check Out") siswa[d.nama].out=d;
        if(stats[d.emoji]!=null) stats[d.emoji]++;
    });

    Object.keys(siswa).forEach(n=>{
        const m=siswa[n].in,p=siswa[n].out;
        tbody.innerHTML+=`
        <tr>
            <td>${n}</td>
            <td>${m?'<span class="badge-masuk">Check In</span>':'-'}</td>
            <td>${m?m.waktu:'-'}</td>
            <td>${m?m.emoji:'-'}</td>
            <td>${p?'<span class="badge-pulang">Check Out</span>':'Belum'}</td>
            <td>${p?p.waktu:'-'}</td>
            <td>${p?p.emoji:'-'}</td>
        </tr>`;
    });

    const total=Object.values(stats).reduce((a,b)=>a+b,0)||1;
    setBar("happy",stats['üòä'],total);
    setBar("sad",stats['üò¢'],total);
    setBar("angry",stats['üò°'],total);
    setBar("scared",stats['üò±'],total);
    setBar("tired",stats['üò¥'],total);
    setBar("excited",stats['ü§©'],total);
}
function setBar(id,val,total){
    const p=Math.round((val/total)*100);
    const bar=document.getElementById(id);
    bar.style.width=p+"%";
    bar.textContent=p+"%";
}

/* ===== DOWNLOAD WITH ANIMATION ===== */
function showDownload(cb){
    const d=document.getElementById("downloadAnim");
    d.classList.add("active");
    setTimeout(()=>{
        d.classList.remove("active");
        cb();
    },1500);
}

function downloadExcel(){
    if(!absensiData.length)return alert("Data kosong");
    showDownload(()=>{
        let csv="Nama,Status,Waktu,Emoji\n";
        absensiData.forEach(d=>csv+=`${d.nama},${d.status},${d.waktu},${d.emoji}\n`);
        const a=document.createElement("a");
        a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
        a.download="absensi_sd_lazuardi.csv";
        a.click();
    });
}

function downloadWord(){
    if(!absensiData.length)return alert("Data kosong");
    showDownload(()=>{
        let html="<h2>Absensi SD Lazuardi</h2><table border='1'>";
        absensiData.forEach(d=>{
            html+=`<tr><td>${d.nama}</td><td>${d.status}</td><td>${d.waktu}</td><td>${d.emoji}</td></tr>`;
        });
        html+="</table>";
        const a=document.createElement("a");
        a.href=URL.createObjectURL(new Blob([html],{type:"application/msword"}));
        a.download="absensi_sd_lazuardi.doc";
        a.click();
    });
}

/* AUTO RESET JAM 22:00 */
setInterval(()=>{
    const n=new Date();
    if(n.getHours()===22 && n.getMinutes()===0){
        localStorage.removeItem("absensiData");
        absensiData=[];
        updateDashboard();
    }
},60000);

updateDashboard();
</script>

</body>
</html>
